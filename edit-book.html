<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Book</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <img src="images/logo.png" alt="Library Logo" class="logo">
        <h1>Edit Book</h1>
        <nav>
            <a href="librarian-dashboard.html">Dashboard</a>
            <a href="manage-books.html">Manage Books</a>
            <div class="profile-dropdown">
                <a href="#">Profile</a>
                <div class="profile-dropdown-content">
                    <a href="profile.html">Edit Profile</a>
                    <a href="logout.html">Logout</a>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <h2>Update Book Details</h2>
        <p>Modify the details of the selected book to keep the library catalog accurate and up-to-date.</p>
        <form id="editBookForm">
            <input type="hidden" name="bookId" id="bookId">
            <input type="text" name="title" id="title" placeholder="Title" required>
            <input type="text" name="author" id="author" placeholder="Author" required>
            <input type="text" name="isbn" id="isbn" placeholder="ISBN">
            <input type="number" name="publication_year" id="publication_year" placeholder="Publication Year">
            <input type="text" name="category" id="category" placeholder="Category" required>
            <button type="submit" class="btn">Update Book</button>
        </form>
    </div>
    <script src="scripts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const bookId = urlParams.get('id');
            if (bookId) {
                fetch(`api.php?action=editBook&bookId=${bookId}`)
                    .then(response => response.json())
                    .then(book => {
                        document.getElementById('bookId').value = book.id;
                        document.getElementById('title').value = book.title;
                        document.getElementById('author').value = book.author;
                        document.getElementById('isbn').value = book.isbn || '';
                        document.getElementById('publication_year').value = book.publication_year || '';
                        document.getElementById('category').value = book.category;
                    });
            }

            const editBookForm = document.getElementById('editBookForm');
            editBookForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(editBookForm);
                const response = await fetch('api.php?action=updateBook', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                alert(result.message);
                window.location.href = 'manage-books.html';
            });
        });
    </script>
</body>
</html>